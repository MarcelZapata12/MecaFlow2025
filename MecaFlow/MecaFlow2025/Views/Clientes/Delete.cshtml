@model MecaFlow2025.Models.Cliente

@{
    ViewData["Title"] = "Eliminar Cliente";
    Layout = null;
}

<style>
    body {
        background-color: transparent;
        color: #f8f9fa;
    }

    .modal-form-container {
        background-color: #1f1f1f;
        border-radius: 1rem;
        padding: 2rem;
        animation: fadeIn 0.3s ease-in-out;
    }

    .dl-horizontal dt {
        font-weight: bold;
        color: #adb5bd;
    }

    .dl-horizontal dd {
        margin-bottom: 0.75rem;
    }

    .btn-danger {
        background-color: #dc3545;
        border-color: #dc3545;
    }

    .btn-danger:hover {
        background-color: #bd2130;
        border-color: #b21f2d;
    }

    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }

    .btn-secondary:hover {
        background-color: #565e64;
        border-color: #4e555b;
    }

    @@keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }
</style>

<div class="modal-form-container">
    <h4 class="mb-3">
        <i class="bi bi-trash-fill me-2 text-danger"></i>
        Confirmar Eliminación
    </h4>

    <p class="text-warning">¿Estás seguro de que deseas eliminar este cliente?</p>

    <dl class="row dl-horizontal">
        <dt class="col-sm-3">Nombre</dt>
        <dd class="col-sm-9">@Model.Nombre</dd>

        <dt class="col-sm-3">Correo</dt>
        <dd class="col-sm-9">@Model.Correo</dd>

        <dt class="col-sm-3">Teléfono</dt>
        <dd class="col-sm-9">@Model.Telefono</dd>

        <dt class="col-sm-3">Dirección</dt>
        <dd class="col-sm-9">@Model.Direccion</dd>

        <dt class="col-sm-3">Fecha de Registro</dt>
        <dd class="col-sm-9">@Model.FechaRegistro?.ToString("dd/MM/yyyy")</dd>
    </dl>

    <form asp-action="Delete" method="post" class="d-flex justify-content-end mt-4" onsubmit="return deleteCliente(this)">
        <input type="hidden" asp-for="ClienteId" />
        <button type="submit" class="btn btn-danger me-2">
            <i class="bi bi-trash-fill me-1"></i> Eliminar
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="bi bi-x-lg me-1"></i> Cancelar
        </button>
    </form>
</div>

@section Scripts {
    <script>
        function deleteCliente(form) {
            const formData = new FormData(form);
            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(res => {
                if (res.ok) {
                    const modalElement = document.querySelector('.modal.show');
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) modal.hide();

                    const clienteId = formData.get('ClienteId');
                    const card = document.getElementById('cliente-' + clienteId);
                    if (card) card.remove();
                }
            });
            return false;
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.open-delete-modal').forEach(button => {
                button.addEventListener('click', async e => {
                    const clienteId = button.dataset.id;
                    const modalBody = document.getElementById('deleteModalBody');
                    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));

                    const res = await fetch(`/Clientes/Delete/${clienteId}`);
                    const html = await res.text();
                    modalBody.innerHTML = html;
                    modal.show();
                });
            });
        });
    </script>
}
