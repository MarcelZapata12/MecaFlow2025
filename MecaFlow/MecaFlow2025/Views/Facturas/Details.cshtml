@model MecaFlow2025.Models.Factura
@using System.Globalization
@{
    ViewData["Title"] = $"Detalle Factura #{Model.FacturaId}";
    string montoCR = Model.MontoTotal.ToString("C", new CultureInfo("es-CR"));
    Layout = null;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<style>
    body {
        background: linear-gradient(135deg, #141e30, #243b55);
        animation: gradientBG 15s ease infinite;
        background-size: 400% 400%;
        color: #fff;
    }

    @@keyframes gradientBG {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }

    .details-card {
        background-color: rgba(33, 37, 41, 0.9);
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        animation: fadeInUp 0.6s ease-in-out;
    }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .details-label {
        font-weight: 600;
        color: #adb5bd;
    }

    .btn-group a {
        min-width: 100px;
    }

    /* Estilos para la tabla de tareas */
    .tareas-table thead th {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: #343a40;
        color: #f8f9fa;
        border-color: #444;
    }

    .tareas-table td, .tareas-table th {
        white-space: nowrap;
        border-color: #444;
        color: #f8f9fa;
    }

    .tareas-table .desc {
        white-space: normal;
    }

    .tareas-table {
        background-color: #2a2a2a;
        color: #f8f9fa;
    }

        .tareas-table tbody tr {
            background-color: #2a2a2a;
        }

            .tareas-table tbody tr:hover {
                background-color: #333;
            }

    .card {
        background-color: #2a2a2a;
        border-color: #444;
    }
</style>

<div class="container py-5">
    <div class="details-card">
        <h2 class="mb-4"><i class="bi bi-info-circle me-2"></i>Detalle Factura #@Model.FacturaId</h2>

        <dl class="row">
            <dt class="col-sm-3 details-label">Cliente</dt>
            <dd class="col-sm-9">@Model.Cliente?.Nombre</dd>

            <dt class="col-sm-3 details-label">Vehículo</dt>
            <dd class="col-sm-9">@Model.Vehiculo?.Placa</dd>

            <dt class="col-sm-3 details-label">Fecha</dt>
            <dd class="col-sm-9">@Model.Fecha.ToString("dd/MM/yyyy")</dd>

            <dt class="col-sm-3 details-label">Monto Total</dt>
            <dd class="col-sm-9">@montoCR</dd>

            <dt class="col-sm-3 details-label">Método de pago</dt>
            <dd class="col-sm-9">@(string.IsNullOrWhiteSpace(Model.Metodo) ? "-" : Model.Metodo)</dd>
        </dl>

        <div class="col-12 mt-4">
            <h5 class="mt-3">Tareas realizadas al vehículo</h5>
            <div class="card shadow-sm">
                @{
                    var tareas = ViewBag.Tareas as IEnumerable<MecaFlow2025.Models.TareasVehiculo>;
                }
                @if (tareas != null)
                {
                    @await Html.PartialAsync("_TareasPorVehiculo", tareas)
                }
                else
                {
                    <div class="p-3 text-muted">No se pudieron cargar las tareas del vehículo.</div>
                }
            </div>
        </div>

        <div class="btn-group mt-4">
            <a asp-action="Index" class="btn btn-outline-light ms-2">
                <i class="bi bi-arrow-left me-1"></i>Volver
            </a>
        </div>
    </div>
</div>