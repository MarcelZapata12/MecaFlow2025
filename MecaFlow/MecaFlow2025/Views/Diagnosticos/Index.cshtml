@model IEnumerable<MecaFlow2025.Models.Diagnostico>

@{
    ViewData["Title"] = "Diagnósticos";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-primary"><i class="bi bi-heart-pulse-fill"></i> Diagnósticos</h2>
        <a asp-action="Create" class="btn btn-success shadow">
            <i class="bi bi-plus-circle"></i> Nuevo Diagnóstico
        </a>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>#</th>
                    <th>Vehículo</th>
                    <th>Fecha</th>
                    <th>Detalle</th>
                    <th>Empleado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @foreach (var d in Model)
                {
                    <tr>
                        <td>@d.DiagnosticoId</td>
                        <td>@d.Vehiculo?.Placa</td>
                        <td>@d.Fecha.ToString("yyyy-MM-dd")</td>
                        <td>@d.Detalle</td>
                        <td>@d.Empleado?.Nombre</td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@d.DiagnosticoId" class="btn btn-warning btn-sm me-1">
                                <i class="bi bi-pencil-square"></i> Editar
                            </a>

                            <!-- Botón Eliminar con data-* -->
                            <button type="button" class="btn btn-danger btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#deleteModal"
                                    data-id="@d.DiagnosticoId"
                                    data-vehiculo="@d.Vehiculo?.Placa"
                                    data-fecha="@d.Fecha.ToString("yyyy-MM-dd")"
                                    data-detalle="@d.Detalle"
                                    data-empleado="@d.Empleado?.Nombre"
                                    onclick="showDeleteModal(this)">
                                <i class="bi bi-trash3"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- MODAL COMPLETO -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel"><i class="bi bi-exclamation-triangle-fill"></i> Confirmar eliminación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <p>¿Estás seguro que deseas eliminar este diagnóstico?</p>
                <ul class="list-group">
                    <li class="list-group-item"><strong>Vehículo:</strong> <span id="modalVehiculo"></span></li>
                    <li class="list-group-item"><strong>Fecha:</strong> <span id="modalFecha"></span></li>
                    <li class="list-group-item"><strong>Detalle:</strong> <span id="modalDetalle"></span></li>
                    <li class="list-group-item"><strong>Empleado:</strong> <span id="modalEmpleado"></span></li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form id="deleteForm" method="post">
                    <button type="submit" class="btn btn-danger">Sí, eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showDeleteModal(button) {
            const id = button.getAttribute("data-id");
            const vehiculo = button.getAttribute("data-vehiculo");
            const fecha = button.getAttribute("data-fecha");
            const detalle = button.getAttribute("data-detalle");
            const empleado = button.getAttribute("data-empleado");

            // Setear valores en el modal
            document.getElementById("modalVehiculo").innerText = vehiculo;
            document.getElementById("modalFecha").innerText = fecha;
            document.getElementById("modalDetalle").innerText = detalle;
            document.getElementById("modalEmpleado").innerText = empleado;

            // Setear URL del formulario
            document.getElementById("deleteForm").action = `/Diagnosticos/Delete/${id}`;
        }
    </script>
}
